데이터 전처리

실제 분석에 들어가는 소요 시간보다 훨씬 많은 시간 및 노력이 필요하다ㅏ.

데이터의 정보를 어떻게 하면 잘 살리면서 분석에 용이한 형태로 만들 수 있을까? 라는 고민이 필요하다.



## 데이터 생성

데이터 생성 - 요약변수, 파생변수

- 요약변수 : 수집된 정보를 분석의 목적에 맞게 종합(aggregate)한 변수. 누구나 동일하게 계산 가능한 객관적인 원리에 의해 종합되어야 함. 단어빈도, 상품별 구매 금액, 구매량, 영화 매출액 등. 재활용성이 높음.



- 파생변수 : 특정 의미를 갖는 작위적 정의에 의한 변수. 매우 주관적일 수 있으므로 논리적 타당성을 갖춰야 함. 구매상품의 다양성 변수(다양성을 어떻게 정의?), 가격 선호대 변수(어느 만큼 좋아해야 선호하는 건지? 구매를 어느 정도 해야 선호하는 건지?), 라이프 스타일 변수(라이프 스타일을 어떻게 분류하고 규정?), 영화 인기도 변수(어느 수준이어야 인기있다고 판단?) 등



## 데이터 정제

데이터 정제 - 결측값, 이상값, 연속형 자료의 범주화

- 결측값(missing value) : 기록 누락, 미응답, 수집 오류(표기 잘못됨. 숫자여야 하는데 문자 기록) 등의 이유로 결측 발생. 결측값이 포함된 자료라도 나머지 변수의 값들은 의미있는 정보이므로, 정보의 손실을 최소화하도록 결측을 처리하는 것이 바람직함. 가능하면 모든 정보를 분석에 반영할 수 있도록 하기. 적절한 값들로 대체.

​	- 완전제거법은 결측값이 하나 이상 포함된 자료를 제거하는 방법인데 정보 손실로 분석 결과가 왜곡될 수 있다.

​	- 평균대체법은 해당 변수의 나머지 값들의 평균으로 결측값을 대체하는 방법. 그러나 추정량의 표준오차가 과소추정되는 문제가 있다. 원래 자료가 갖는 변동성보다 훨씬 작게 측정될 수 있다는 점을 염두에 두어야 한다. 추정 오차가 작을 거라고 잘못 판단할 수 있다.

​	- 핫덱대체법은 동일한 데이터 내에서 결측값이 발생한 관찰치와 유사한 특성을 가진 다른 관찰치의 정보를 이용하여 대체하는 방법

​	- 그 외 회귀(regression), KNN(k-nearest neighbor) 등 모델을 이용한 처리법들도 있다.



- 이상값 : 다른 데이터와 동떨어진 것을 말함. 단순히 입력 오류로 발생할 값일 수도 있고, 다른 자료값들에 비해 멀리 떨어져 있지만 의미가 있는 값일 수도 있다. 잘 모를 때는 이상값을 제외한 분석과 이상값을 포함한 분석을 둘 다 해본 다음에 결과를 비교해보며 이상값의 효과를 정리해보는 방법이 도움이 된다. 이상치가 있으면 분석 결과에 중요한 차이를 발생시킬 수 있기 때문에 잘 처리해줘야 한다.



이상값(outlier)의 탐지 방법

- 상자그림(box plot)

: Q1-1.5*IQR부터 Q3+1.5IQR까지의 바운더리 안에 있는 값들은 정상값으로 처리하고, 그 밖의 값들은 이상값으로 진단한다. 이상값은 동그라미로 표현한다. 이상값을 결정하는 범위를 정하는 1.5라는 숫자를 tukey의 계수라고 하는데, 자료에 따라 다른 값을 줄 수 있다. 1.5로 뒀을 때 이상값이 너무 많이 나올 것 같다 싶으면 3, 5 등 값을 더 키워서 판단하면 된다.



Q1: 25% 지점

Q2: 50% 지점. 중앙값(median)

Q3: 75% 지점

IQR(Interquartile Range): 자료의 가운데 50% 부분 (25-75%)



- 표준화 점수(Z-score)

: 자료들의 평균, 표준편차를 구해서 각 자료값에서 평균을 빼고 표준편차로 나눠서 표준화 점수를 만든다. 그러면 평균이 0, 표준편차가 1이 되며 정규분포를 따르므로, 절대값이 크다는 것은 평균으로부터 멀리 떨어져있음을 의미하므로 절대값이 2, 3보다 큰 경우를 이상값으로 진단하는 방법.



이상값 처리 방법

- 이상값 제외(trimming) : 처리는 간단하지만, 정보 손실이 발생하고 추정량 왜곡이 생길 수 있음.
- 이상값 대체(winsorization) : 먼저 정상값의 범위를 정의한다. 이상값을 정상값 중 최대 또는 최소 등으로 대체하는 방식. 가능한 한 정보를 살리는 방향으로 보완하는 것. 분포의 꼬리가 긴 형태를 꼬리가 짧은 형태로 보완.
- 변수변환 : 자료값 전체에 로그변환, 제곱근변환 등을 적용. 대표적으로 분포의 오른쪽 꼬리가 길 때 꼬리를 앞으로 당겨서 대칭화시켜주기. 로그변환을 하면 값이 스케일이 줄어듦. 제곱근변환도 그러함. 극단값(이상값)들이 줄어들면서 정보는 살릴 수 있음. 복구하고자 하면 언제든지 다시 복구할 수 있다는 장점도 있음.



\- 연속형 자료의 범주화

변수구간화(binning)

: 연속형 변수를 구간을 이용하여 범주화하는 과정. 숫자가 주어졌을 때 범주화하기.



변수구간화의 효과

- 결측치 처리 방법이 될 수 있음
- 이상치 문제를 완화
- 변수간 관계가 단순화되어 분석 시 과적합을 방지할 수 있고, 결과 해석이 용이해짐. 범주화된 변수는 원래 숫자들에 비해 정확도는 아무래도 좀 떨어진다. 범주 구간을 좀 더 촘촘하게 나누면 정확도가 증가하지만, 너무 촘촘하게 해서 구간을 많이 만들면 범주화 효과가 상실됨. 그러므로 적절한 구간을 잘 정의해서 자료의 패턴을 잘 반영하면서 범주의 효과를 살릴 수 있는 형태로 범주화해주는 게 좋다!



## 데이터 변환

데이터 변환 - 로그변환, 지수변환, 제곱근변환, 제곱변환

데이터 변환 : 자료 변환을 통해 자료의 해석을 쉽고 풍부하게 하기 위한 과정.



데이터 변환 목적

- 분포의 대칭화
- 산포를 비슷하게 하기 위하여
- 변수 간 관계를 단순화하기 위하여 (비선형 -> 선형)



데이터 변환 1 : 제곱근변환 vs 제곱변환

제곱근변환은 분포의 왼쪽꼬리를 길게,

제곱변환은 분포의 오른쪽꼬리를 길게 하는 효과

-> 원래 분포가 오른쪽꼬리가 길면 제곱근변환, 분포가 왼쪽꼬리가 길면 제곱변환을 적용

혹은, 변수 간 관계가 비선형일 때 선형화하고 싶다. 그러면 x를 제곱변환하여 키워주거나, y를 제곱근변환하여 줄여주거나 둘 중 하나의 방법을 적용하면 선형 관계가 될 것.



데이터 변환 2 : 로그변환 vs 지수변환

로그변환은 분포의 왼쪽꼬리를 길게,

지수변환은 분포의 오른쪽꼬리를 길게 하는 효과

-> 원래 분포가 오른쪽꼬리가 길면 로그변환, 분포가 왼쪽꼬리가 길면 지수변환을 적용. (제곱근변환, 제곱변환의 경우보다 치우침이 더 많이 생긴다.)

혹은, 변수 간 관계가 비선형일 때 선형화하고 싶다. 그러면 x를 로그변환하여 줄여주거나, y를 지수변환하여 키워주거나 둘 중 하나의 방법을 적용하면 선형 관계가 될 것. (정도가 심하지 않다면 제곱근변환, 제곱변환을 사용 가능)



박스콕스 변환(Box-Cox Transform) (파워 변환이라고 부름)

: 위의 변환들을 일반화한 것. 원래 자료값에 p제곱해준다는 개념

0<p<1	제곱근변환

p>1		제곱변환

p=0		로그변환

p=∞		지수변환

박스콕스 변환은 다 (0,0)을 통과한다.

y=0인 지점(시작 지점)에서 미분값(기울기)는 1이다.

로그변환이 가장 심하게 낮춘 형태의 변환 (즉, 오른쪽 꼬리가 아주 길 때 대칭화하고 싶으면 최대 로그변환까지 생각할 수 있다는 의미!)

지수변환이 가장 심하게 높인 형태의 변환 (즉, 왼쪽 꼬리가 아주 길 때 대칭화하고 싶으면 최대 지수변환까지 생각할 수 있다는 의미!)

-> 박스콕스 변환은 자료의 대칭화, 산포 균등화, 변수 간의 관계 단순화 등의 우리 목적을 감안해서 p의 값만 최적화해서 쉽게 변환할 수 있는 일반적인 형태의 변환!



정리

오른쪽 꼬리가 긴 분포의 경우 - 제곱근변환, 로그변환

왼쪽 꼬리가 긴 분포의 경우 - 제곱변환, 지수변환



## 데이터 결합

데이터 결합 - 이너조인, 레프트조인, 라이트조인, 풀아우터조인



변수 이름, 변수 내용물이 동일한 속성으로 구성되어 있다면

두 테이블을 결합할 때 key 변수가 됨.



이너조인 : (교집합) 공통인 키만 가지고 결합

풀아우터조인 : (합집합) 두 테이블 중 어느 한쪽이라도 존재하는 키에 대해 모두 결합. 빈 자리는 NA 처리

레프트조인 : 왼쪽 테이블에 존재하는 키만 가지고 결합. 빈 자리는 NA 처리

라이트조인 : 오른쪽 테이블에 존재하는 키만 가지고 결합. 빈 자리는 NA 처리



일반적으로 이너조인, 레프트조인이 많이 활용된다.
